// Данные теста
const testData = {
    blocks: [
        {
            name: "Блок 1: Академический стресс",
            questions: [
                "Мысли об учебе не дают мне уснуть ночью.",
                "Я чувствую панику, когда думаю о предстоящих экзаменах.",
                "Объем учебной нагрузки кажется мне непосильным.",
                "Я боюсь не успеть выполнить работу в срок (не уложиться в дедлайн).",
                "Я постоянно сравниваю свои академические успехи с успехами одногруппников.",
                "Мне кажется, что я должен(на) учиться лучше, чем другие.",
                "Я чувствую, что не соответствую требованиям преподавателей.",
                "После пар я чувствую себя эмоционально истощенным(ой).",
                "У меня нет мотивации учиться, хотя я понимаю, что это необходимо.",
                "Я пропускаю пары из-за того, что не могу заставить себя пойти.",
                "Я чувствую себя неудачником(кой) после получения низкой оценки.",
                "Во время занятий или подготовки мое сердцебиение учащается, я чувствую напряжение.",
                "Мне трудно сосредоточиться на лекции или чтении учебника.",
                "Я забываю важную информацию (даты, термины, формулы).",
                "Я чувствую, что выбранная мной специальность — это ошибка.",
                "Я не вижу практического применения тем знаниям, которые получаю.",
                "Я опасаюсь, что не смогу найти работу после окончания вуза.",
                "Академическая неуспеваемость кажется мне катастрофой.",
                "Я жертвую сном, чтобы успеть подготовиться к занятиям.",
                "Преподаватели предъявляют завышенные и несправедливые требования."
            ]
        },
        {
            name: "Блок 2: Социальный стресс",
            questions: [
                "Мне трудно знакомиться и общаться с новыми людьми в университете.",
                "Я чувствую себя одиноким(ой) в группе или в общежитии.",
                "Я боюсь быть отвергнутым(ой) или осмеянным(ой) сверстниками.",
                "Мне трудно отказывать одногруппникам, даже когда их просьбы мне неудобны.",
                "Я чувствую давление со стороны друзей, чтобы я соответствовал(ла) их стандартам (внешность, поведение, интересы).",
                "Конфликты с одногруппниками или соседями по общежитию выбивают меня из колеи.",
                "Я чувствую, что моя семья возлагает на меня слишком большие надежды в учебе.",
                "Я боюсь разочаровать своих родителей или родственников.",
                "Мои отношения с семьей напряженные из-за учебы или моего выбора.",
                "Мне не с кем обсудить свои настоящие переживания и проблемы.",
                "Я зависую от мнения окружающих о себе.",
                "В социальных ситуациях я чувствую тревогу и желание поскорее уйти.",
                "Я чувствую, что не вписываюсь в общую атмосферу моего вуза/группы.",
                "Мне кажется, что у всех вокруг больше друзей и насыщенная социальная жизнь.",
                "Давление со стороны близких относительно моего будущего (карьеры, личной жизни) вызывает у меня стресс."
            ]
        },
        {
            name: "Блок 3: Личностный и эмоциональный стресс",
            questions: [
                "В последнее время я часто чувствую раздражительность и нервозность.",
                "Мне грустно или тоскливо без очевидной причины.",
                "Я чувствую апатию, мне ничего не интересно.",
                "Мне трудно контролировать свои эмоции.",
                "Я часто плачу или чувствую, что готов(а) расплакаться.",
                "Я испытываю чувство вины, когда отдыхаю, а не работаю.",
                "Я критикую и ругаю себя за малейшие ошибки.",
                "У меня бывают резкие перепады настроения.",
                "Я чувствую себя беспомощным(ой) и неспособным(ой) справиться с проблемами.",
                "Мне не хватает уверенности в себе и своих силах.",
                "Я чувствую себя перегруженным(ой) и неспособным(ой) \"все успеть\".",
                "Меня преследуют навязчивые тревожные мысли.",
                "Я с трудом просыпаюсь по утрам и чувствую усталость в течение дня.",
                "У меня нет целей или я сомневаюсь в своих жизненных ориентирах.",
                "Я чувствую, что от меня ничего не зависит.",
                "Меня пугает необходимость принимать важные жизненные решения.",
                "Я не чувствую удовлетворения от того, что делаю.",
                "Мне кажется, что я ношу маску, чтобы скрыть свои истинные чувства от других.",
                "Я смотрю в будущее со страхом и пессимизмом.",
                "Я чувствую, что моя жизнь вышла из-под контроля."
            ]
        },
        {
            name: "Блок 4: Физиологические симптомы и образ жизни",
            questions: [
                "У меня проблемы со сном (бессонница, чуткий сон, кошмары).",
                "Я испытываю напряжение в мышцах (шея, спина, челюсти).",
                "У меня часто болит голова.",
                "У меня есть проблемы с пищеварением (боли в желудке, расстройство).",
                "Мой аппетит заметно изменился (я стал(а) есть намного больше или меньше).",
                "Я часто простужаюсь, мой иммунитет ослаб.",
                "Я замечаю у себя дрожь в руках или учащенное сердцебиение без физической нагрузки.",
                "Я чувствую постоянную усталость, даже после отдыха.",
                "У меня почти не остается энергии на хобби и личные дела.",
                "Я использую алкоголь, сигареты или другие вещества, чтобы расслабиться.",
                "Я провожу много времени за просмотром соцсетей/сериалов, чтобы \"отключиться\".",
                "Я пренебрегаю физической активностью.",
                "Мой режим дня хаотичен (нерегулярное питание, сон).",
                "Я трачу мало времени на уход за собой (гигиена, внешний вид).",
                "Я заметил(а) у себя появление нервных привычек (грызу ногти, накручиваю волосы и т.д.)."
            ]
        },
        {
            name: "Блок 5: Стратегии совладания и ресурсы",
            questions: [
                "Когда у меня проблема, я стараюсь проанализировать ее и составить план действий.",
                "В сложной ситуации я обращаюсь за поддержкой к друзьям или родным.",
                "Я знаю и применяю техники релаксации (дыхание, медитация).",
                "В стенах вуза я знаю, к кому можно обратиться за помощью (куратор, психолог).",
                "В трудные моменты я предпочитаю держать все в себе и никого не беспокоить.",
                "Я виню в своих проблемах обстоятельства или других людей.",
                "Я откладываю решение проблем до последнего момента (прокрастинирую).",
                "Когда я напряжен(а), я становлюсь нерешительным(ой).",
                "Мне помогает смена деятельности (прогулка, хобби, спорт).",
                "Я могу попросить о помощи, когда она мне действительно нужна."
            ]
        }
    ],
    methods: [
        {
            id: 1,
            name: "Анализ и когнитивная реструктуризация ситуаций",
            description: "Этот метод основан на принципах когнитивно-поведенческой терапии (КПТ) и помогает переосмыслить стрессовые мысли, заменяя их на более реалистичные.",
            mechanism: "Идентификация \"мышеловок\" мышления (например, катастрофизация: \"Если я не получу отличную оценку, семья разочаруется навсегда\") и их замена на сбалансированные взгляды.",
            steps: [
                "Запишите стрессовую ситуацию и связанные мысли.",
                "Оцените их по шкале правдоподобности (1–10).",
                "Найдите доказательства за и против.",
                "Сформулируйте альтернативную мысль.",
                "Оцените эмоциональное улучшение."
            ],
            practice: "Практикуйте 10–15 минут ежедневно.",
            example: "Если академическая конкуренция вызывает мысль \"Я хуже всех\", замените на \"Я конкурирую с собой, и прогресс важен\".",
            benefits: "Улучшает академическую мотивацию, снижает тревогу и повышает благополучие.",
            priority: "moderate"
        },
        {
            id: 2,
            name: "Физическая активность и спорт",
            description: "Физические упражнения стимулируют выработку эндорфинов (гормонов счастья), снижают уровень кортизола (гормона стресса) и улучшают сон.",
            mechanism: "Активность отвлекает от тревог, улучшает когнитивные функции и повышает устойчивость.",
            steps: [
                "Выберите приятный вид активности (прогулки, йога, бег или командные игры).",
                "Начните с 20–30 минут 3–5 раз в неделю.",
                "Интегрируйте в расписание, например, после лекций.",
                "Отслеживайте настроение до и после."
            ],
            practice: "3–5 раз в неделю по 20–30 минут.",
            example: "Студент, испытывающий давление сверстников, может присоединиться к университетскому спортивному клубу для социализации и релакса.",
            benefits: "Снижает симптомы тревоги и депрессии, улучшает академическую производительность и предотвращает выгорание.",
            priority: "low"
        },
        {
            id: 3,
            name: "Поиск социальной поддержки",
            description: "Социальная поддержка снижает ощущение изоляции, предоставляя эмоциональную разрядку и практические советы.",
            mechanism: "Общение активирует окситоцин, снижая стресс, и помогает переосмыслить проблемы.",
            steps: [
                "Определите доверенных людей (друзья, семья, одногруппники).",
                "Запланируйте регулярные встречи или звонки.",
                "Обсудите конкретные стрессоры, спрашивая о советах.",
                "Участвуйте в группах поддержки в университете."
            ],
            practice: "Регулярные встречи или звонки с доверенными людьми.",
            example: "При стрессе от конкуренции обсудите с другом стратегии, чтобы почувствовать солидарность.",
            benefits: "Укрепляет отношения, снижает тревогу и улучшает ментальное здоровье через чувство принадлежности.",
            priority: "moderate"
        },
        {
            id: 4,
            name: "Управление временем и планирование",
            description: "Этот метод предотвращает перегрузку, помогая балансировать учебу и отдых.",
            mechanism: "Структурирование снижает хаос, повышая контроль и снижая тревогу.",
            steps: [
                "Создайте еженедельный календарь с задачами.",
                "Приоритизируйте по urgency (Eisenhower matrix).",
                "Устанавливайте реалистичные цели и перерывы.",
                "Используйте инструменты вроде приложений (Todoist).",
                "Ежедневно пересматривайте план."
            ],
            practice: "Ежедневное планирование и пересмотр плана.",
            example: "Разделите подготовку к экзамену на ежедневные блоки, чтобы избежать давления семьи.",
            benefits: "Улучшает производительность, снижает стресс и повышает уверенность.",
            priority: "low"
        },
        {
            id: 5,
            name: "Медитация и дыхательные упражнения",
            description: "Эти практики активируют парасимпатическую систему, снижая реакцию \"борьба или бегство\".",
            mechanism: "Фокус на дыхании снижает кортизол и улучшает концентрацию.",
            steps: [
                "Сядьте комфортно.",
                "Дышите глубоко: вдох на 4 секунды, задержка на 4, выдох на 4.",
                "Добавьте медитацию (приложения вроде Headspace).",
                "Практикуйте 5–10 минут ежедневно."
            ],
            practice: "5–10 минут ежедневно.",
            example: "Перед сном для снижения стресса от конкуренции.",
            benefits: "Снижает тревогу, улучшает сон и фокус.",
            priority: "moderate"
        },
        {
            id: 6,
            name: "Журналирование и выплеск эмоций",
            description: "Запись мыслей помогает обработать эмоции, снижая стресс от выплеска.",
            mechanism: "Выражение снижает эмоциональное накопление и стимулирует рефлексию.",
            steps: [
                "Выделите 10–15 минут.",
                "Опишите эмоции и стрессоры.",
                "Добавьте благодарности или позитив.",
                "Анализируйте паттерны."
            ],
            practice: "10–15 минут 2–3 раза в неделю.",
            example: "Запишите разочарование от конкуренции, затем позитивные аспекты.",
            benefits: "Снижает тревогу, улучшает эмоциональный контроль.",
            priority: "moderate"
        },
        {
            id: 7,
            name: "Здоровое питание и сон",
            description: "Балансированное питание и сон поддерживают мозг, снижая стресс.",
            mechanism: "Питательные вещества (омега-3, витамины) и 7–9 часов сна регулируют гормоны.",
            steps: [
                "Ешьте овощи, фрукты, цельные зерна.",
                "Избегайте сахара/кофеина вечером.",
                "Установите режим сна."
            ],
            practice: "Ежедневно: 7–9 часов сна, сбалансированное питание.",
            example: "Завтрак с овсянкой для энергии против конкуренции.",
            benefits: "Улучшает фокус, снижает раздражительность.",
            priority: "low"
        },
        {
            id: 8,
            name: "Профессиональная помощь",
            description: "Когда стресс критичен (шкала 4–5), обращайтесь к специалистам для терапии.",
            mechanism: "Эксперты помогают с глубокими проблемами.",
            steps: [
                "Оцените симптомы (бессонница, апатия).",
                "Обратитесь в университетский центр или терапевта."
            ],
            practice: "Регулярные сессии с психологом или терапевтом.",
            example: "Если давление семьи вызывает депрессию, профессиональная помощь необходима.",
            benefits: "Глубокая работа с проблемами, профессиональная поддержка, предотвращение усугубления состояния.",
            priority: "high"
        }
    ]
};

// Инициализация теста
function initTest() {
    const container = document.getElementById('questions-container');
    let questionIndex = 0;

    testData.blocks.forEach((block, blockIndex) => {
        const blockDiv = document.createElement('div');
        blockDiv.className = 'block';
        blockDiv.innerHTML = `<h3>${block.name}</h3>`;

        block.questions.forEach((question, qIndex) => {
            questionIndex++;
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question';
            
            const questionText = document.createElement('div');
            questionText.className = 'question-text';
            questionText.textContent = `${qIndex + 1}. ${question}`;
            
            const radioGroup = document.createElement('div');
            radioGroup.className = 'radio-group';
            
            for (let i = 1; i <= 5; i++) {
                const option = document.createElement('div');
                option.className = 'radio-option';
                
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = `q${blockIndex}_${qIndex}`;
                radio.value = i;
                radio.id = `q${blockIndex}_${qIndex}_${i}`;
                radio.required = true;
                
                const label = document.createElement('label');
                label.htmlFor = `q${blockIndex}_${qIndex}_${i}`;
                label.textContent = i;
                
                option.appendChild(radio);
                option.appendChild(label);
                radioGroup.appendChild(option);
            }
            
            questionDiv.appendChild(questionText);
            questionDiv.appendChild(radioGroup);
            blockDiv.appendChild(questionDiv);
        });
        
        container.appendChild(blockDiv);
    });
}

// Подсчет результатов
function calculateResults(formData) {
    const blockScores = [0, 0, 0, 0, 0];
    let totalScore = 0;
    
    testData.blocks.forEach((block, blockIndex) => {
        block.questions.forEach((question, qIndex) => {
            const value = parseInt(formData.get(`q${blockIndex}_${qIndex}`));
            
            if (blockIndex === 4) {
                // Блок 5: обратная шкала (5 = 1 балл, 1 = 5 баллов)
                const reversedValue = 6 - value;
                blockScores[blockIndex] += reversedValue;
                totalScore += reversedValue;
            } else {
                // Блоки 1-4: обычная шкала (1 = 1 балл, 5 = 5 баллов)
                blockScores[blockIndex] += value;
                totalScore += value;
            }
        });
    });
    
    return { totalScore, blockScores };
}

// Определение уровня стресса
function getStressLevel(score) {
    if (score >= 80 && score <= 160) {
        return {
            level: 'low',
            name: 'Низкий уровень стресса',
            description: 'Вы хорошо справляетесь с нагрузками. Ваши стратегии преодоления стресса эффективны. Рекомендуется продолжать практиковать здоровые привычки.',
            class: 'low'
        };
    } else if (score >= 161 && score <= 240) {
        return {
            level: 'moderate',
            name: 'Умеренный уровень стресса',
            description: 'Вы испытываете стресс, характерный для студенческой жизни. Есть области, на которые стоит обратить внимание, чтобы предотвратить усиление стресса. Рекомендуется начать использовать техники релаксации и тайм-менеджмента.',
            class: 'moderate'
        };
    } else if (score >= 241 && score <= 320) {
        return {
            level: 'high',
            name: 'Высокий уровень стресса',
            description: 'Стресс серьезно влияет на ваше самочувствие и качество жизни. Вам настоятельно рекомендуется обратиться за поддержкой: к друзьям, семье или в психологическую службу вуза.',
            class: 'high'
        };
    } else {
        return {
            level: 'critical',
            name: 'Очень высокий, критический уровень стресса',
            description: 'Ваше психологическое и физическое здоровье под угрозой. Крайне важно немедленно обратиться за профессиональной помощью к психологу или врачу.',
            class: 'critical'
        };
    }
}

// Получение рекомендаций по блоку
function getBlockRecommendation(blockIndex) {
    const recommendations = [
        "Нужна академическая поддержка, тайм-менеджмент, работа с тревогой перед экзаменами.",
        "Нужна работа над коммуникативными навыками, разрешением конфликтов, выстраиванием личных границ.",
        "Важна работа с психологом над самооценкой, эмоциональным регулированием, личными установками.",
        "Необходима коррекция образа жизни, консультация у врача, обучение техникам релаксации.",
        "Показывают деструктивные и неэффективные стратегии совладания."
    ];
    return recommendations[blockIndex];
}

// Получение методов по приоритету
function getMethodsByPriority(stressLevel) {
    const methods = [...testData.methods];
    
    if (stressLevel === 'low') {
        // Низкий стресс: методы с priority "low"
        return methods.filter(m => m.priority === 'low');
    } else if (stressLevel === 'moderate') {
        // Умеренный стресс: методы с priority "moderate"
        return methods.filter(m => m.priority === 'moderate');
    } else {
        // Высокий/критический стресс: все методы, но приоритет на "high"
        const highPriority = methods.filter(m => m.priority === 'high');
        const moderatePriority = methods.filter(m => m.priority === 'moderate');
        const lowPriority = methods.filter(m => m.priority === 'low');
        return [...highPriority, ...moderatePriority, ...lowPriority];
    }
}

// Отображение результатов
function displayResults(results) {
    const { totalScore, blockScores } = results;
    const stressLevel = getStressLevel(totalScore);
    
    // Показать контейнер результатов
    document.getElementById('test-container').classList.add('hidden');
    document.getElementById('results-container').classList.remove('hidden');
    
    // Отображение баллов
    const scoreDisplay = document.getElementById('score-display');
    scoreDisplay.innerHTML = `
        <h3>Ваш результат</h3>
        <div class="score-value">${totalScore}</div>
        <p>баллов из 400</p>
    `;
    
    // Описание уровня
    const levelDesc = document.getElementById('level-description');
    levelDesc.className = `level-description ${stressLevel.class}`;
    levelDesc.innerHTML = `
        <h3>${stressLevel.name}</h3>
        <p>${stressLevel.description}</p>
    `;
    
    // Анализ блоков
    const maxBlockScore = Math.max(...blockScores);
    const maxBlockIndex = blockScores.indexOf(maxBlockScore);
    const blockNames = [
        "Академический стресс",
        "Социальный стресс",
        "Личностный и эмоциональный стресс",
        "Физиологические симптомы и образ жизни",
        "Стратегии совладания и ресурсы"
    ];
    
    const blockAnalysis = document.getElementById('block-analysis');
    blockAnalysis.innerHTML = `
        <h3>Анализ по блокам</h3>
        <p>Блок с наибольшим количеством баллов указывает на основной источник вашего стресса:</p>
        <div class="block-scores">
            ${blockScores.map((score, index) => `
                <div class="block-score-item ${index === maxBlockIndex ? 'highest' : ''}">
                    <strong>${blockNames[index]}</strong><br>
                    ${score} баллов
                </div>
            `).join('')}
        </div>
        <p style="margin-top: 15px;"><strong>Основной источник стресса:</strong> ${blockNames[maxBlockIndex]}</p>
        <p>${getBlockRecommendation(maxBlockIndex)}</p>
    `;
    
    // Рекомендации методов
    const methods = getMethodsByPriority(stressLevel.level);
    const recommendations = document.getElementById('recommendations');
    recommendations.innerHTML = `
        <h3>Рекомендуемые методы преодоления стресса</h3>
        ${methods.map(method => `
            <div class="method ${method.priority}-priority">
                <h4>${method.name}</h4>
                <div class="method-content">
                    <p><strong>Описание:</strong> ${method.description}</p>
                    <p><strong>Механизм действия:</strong> ${method.mechanism}</p>
                    <div class="method-steps">
                        <strong>Шаги:</strong>
                        <ol>
                            ${method.steps.map(step => `<li>${step}</li>`).join('')}
                        </ol>
                    </div>
                    <p><strong>Практика:</strong> ${method.practice}</p>
                    <p><strong>Пример:</strong> ${method.example}</p>
                    <p><strong>Преимущества:</strong> ${method.benefits}</p>
                </div>
            </div>
        `).join('')}
    `;
    
    // Прокрутка вверх
    window.scrollTo(0, 0);
}

// Обработка отправки формы
document.getElementById('stress-test-form').addEventListener('submit', (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const results = calculateResults(formData);
    displayResults(results);
});

// Кнопка перезапуска
document.getElementById('restart-btn').addEventListener('click', () => {
    document.getElementById('test-container').classList.remove('hidden');
    document.getElementById('results-container').classList.add('hidden');
    document.getElementById('stress-test-form').reset();
    window.scrollTo(0, 0);
});

// Инициализация при загрузке
initTest();

